<%- include('partials/header') %>

<div class="container mt-5">
  <div class="card shadow-sm">
    <div class="card-body animate__animated animate__fadeIn">
      <h5 class="card-title mb-4"><%= locals.product ? 'Edit 3AQAR' : 'Add New 3AQAR' %></h5>
      <form class="was-validated" action="<%= locals.product ? `/product/${product.id}/edit?_method=PATCH` : '/submit' %>" method="POST" enctype="multipart/form-data">
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">

        <div class="mb-3">
          <label for="validationCustom01" class="form-label">3AQAR Title</label>
          <input type="text" class="form-control" id="validationCustom01" placeholder="Required 3AQAR Title" name="title" required value="<%= locals.product ? product.name : '' %>">
          <div class="invalid-feedback">Please enter a title.</div>
        </div>

        <div class="mb-3">
          <label for="validationTextarea" class="form-label">3AQAR Description</label>
          <textarea class="form-control" id="validationTextarea" placeholder="Required 3AQAR Description" name="description" required><%= locals.product ? product.description : '' %></textarea>
          <div class="invalid-feedback">Please enter a description.</div>
        </div>

        <div class="input-group mb-3">
          <span class="input-group-text">$</span>
          <input type="text" class="form-control" aria-label="Amount" name="price" placeholder="Required 3AQAR Price" required pattern="^\d+(\.\d{1,2})?$" title="Please enter a valid price" value="<%= locals.product && locals.product.minimum_price ? Number(String(product.minimum_price).replace(/[^0-9.]/g, '')) : '' %>">
          <span class="input-group-text">.00</span>
        </div>

        <div class="mb-3">
          <select class="form-select" required aria-label="select example" name="category">
            <option value="">Select Category</option>
            <% if (categories && categories.length > 0) { %>
            <% for (let category of categories) { %>
            <option value="<%= category.id %>" <%= locals.product && locals.product.category_id === category.id ? 'selected' : '' %>><%= category.name %></option>
            <% } %>
            <% } else { %>
            <option disabled>No categories available</option>
            <% } %>
          </select>
          <div class="invalid-feedback">Please select a category</div>
        </div>

        <div class="mb-3">
          <label class="form-label">3AQAR Photos</label>
          <div class="row g-2">
            <% const photoInputs = [1, 2, 3]; %>
            <% photoInputs.forEach(i => { %>
            <div class="col-md-4">
              <input type="file" class="form-control" name="photo<%= i %>" id="photo<%= i %>" <%= i === 1 && !locals.product ? 'required' : '' %>>
              <% if (locals.product && locals.product['image' + i]) { %>
              <img id="preview<%= i %>" src="data:image/webp;base64,<%= product['image' + i].toString('base64') %>" class="img-thumbnail mt-2 post-img" alt="" />
              <% } else { %>
              <img id="preview<%= i %>" class="img-thumbnail mt-2 d-none post-img" alt="" />
              <% } %>
              <% if (i === 1) { %>
              <div class="invalid-feedback">Main photo is required</div>
              <% } %>
            </div>
            <% }) %>
          </div>
        </div>

        <div class="form-check mb-3">
          <input type="checkbox" class="form-check-input" id="validationFormCheck1" required>
          <label class="form-check-label" for="validationFormCheck1">Agree to terms and conditions</label>
        </div>

        <input type="hidden" name="user_id" value="<%= userId %>" />

        <div class="mb-3 d-flex justify-content-between">
          <button class="btn btn-primary" type="submit">
            <%= locals.product ? 'Update' : 'Submit' %>
          </button>

          <a href="<%= locals.product ? `/product/${product.id}` : '/' %>" class="btn btn-secondary">Cancel</a>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="/js/post.js"></script>

<%- include('partials/footer') %>